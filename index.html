<!DOCTYPE html>
<html>
  <head>
    <script src="jquery.js"></script>
    <script src="data_generator.js"></script>
  </head>
  <body>
    <script>

      $(document).ready(function(){

        //Formats Timestamp mm/dd hh:mm
        var formatDateTime = function(d) {
          
          var pad = function(num) {
            if (num < 10) { return "0" + num };
            return num;
          }

          var date = pad(d.getDate());
          var month = pad(d.getMonth()+1);
          var hour = pad(d.getHours());
          var min = pad(d.getMinutes());

          return month + '/' + date + ' ' + hour + ':' + min;
        }

        function buildTweet(tweetLocation, appendLocation, index) {
          var tweet = tweetLocation[index];
          var $tweet = $('<div data-user="' + tweet.user + '"></div>');
          var timestamp = formatDateTime(tweet.created_at);
          var tweetText = '';
          tweetText += timestamp + ' ';
          tweetText += '@<span class="username">';
          tweetText += tweet.user;
          tweetText += '</span>: ';
          tweetText += tweet.message;
          $tweet.html(tweetText);
          $tweet.appendTo(appendLocation);
        }

        //takes a username or 'home' for home timeline
        //also, takes the location to append the tweets to
        var getTweets = function(userName, appendLocation) {
          var tweetLocation = userName === 'home' ? streams.home : streams.users[userName];
          var index = tweetLocation.length - 1;
          while(index >= 0){
            buildTweet(tweetLocation, appendLocation, index);
          index -= 1;
          };
        };

        var $body = $('body');
        $body.html('');

        //Add a div for home timeline
        var $home = $('<div data-location="home"></div>');
        $home.appendTo($body);
        getTweets('home', $home);

        //Click handler for username
        //Shows that user's timeline
        $('.username').on('click', function(){
  
          //hide the div with home timeline messages
          $home.remove();

          //show a div with just this user's messages
          var userName = $(this).text();
          var $userTimeline = $('<div></div>');
          $userTimeline.appendTo($body);
          getTweets(userName, $userTimeline);
        });

      });

    </script>
  </body>
</html>
